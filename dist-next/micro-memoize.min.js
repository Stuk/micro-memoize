!(function (t, i) {
  'object' == typeof exports && 'undefined' != typeof module
    ? (module.exports = i())
    : 'function' == typeof define && define.amd
    ? define(i)
    : ((t = 'undefined' != typeof globalThis ? globalThis : t || self)[
        'micro-memoize'
      ] = i());
})(this, function () {
  'use strict';
  function t(t) {
    for (var i = [], n = 0, h = t.length; n < h; ++n) i[n] = t[n];
    return i;
  }
  function i(t, i, n) {
    return typeof i === t ? i : n;
  }
  function n(t) {
    return { key: t.k, value: t.v };
  }
  function h(t, i) {
    return t === i || (t != t && i != i);
  }
  var e = (function () {
    function e(n) {
      (this.h = null), (this.s = 0), (this.t = null);
      var e = i('function', n.transformKey);
      (this.a = i('function', n.matchesArg, h)),
        (this.l = i('number', n.maxSize, 1)),
        (this.m = i('function', n.matchesKey, this.e)),
        (this.o = i('function', n.onCache)),
        (this.p = i('boolean', n.async, !1)),
        (this.c = !!e || n.matchesKey === this.m),
        (this.k = this.c
          ? e
            ? function (i) {
                return e(t(i));
              }
            : t
          : void 0);
    }
    return (
      (e.prototype.clear = function () {
        this.h = this.t = null;
      }),
      (e.prototype.delete = function (t) {
        var i = t.n,
          h = t.p;
        i ? (i.p = h) : (this.t = h),
          h ? (h.n = i) : (this.h = i),
          --this.s,
          this.o && this.o('delete', n(t), this);
      }),
      (e.prototype.has = function (t) {
        return !!this.g(t);
      }),
      (e.prototype.set = function (t, i) {
        var h = this.g(t);
        if (!h) {
          var e = this.n(t, i);
          return this.o && this.o('add', n(e), this), e;
        }
        return (
          h === this.h ? (h.v = i) : this.u(h),
          this.o && this.o('update', n(h), this),
          h
        );
      }),
      (e.prototype.snapshot = function () {
        for (var t = [], i = this.h; null != i; ) t.push(n(i)), (i = i.n);
        return t;
      }),
      (e.prototype.e = function (t, i) {
        var n = i.length;
        if (t.length !== n) return !1;
        if (1 === n) return this.a(t[0], i[0]);
        for (var h = 0; h < n; ++h) if (!this.a(t[h], i[h])) return !1;
        return !0;
      }),
      (e.prototype.f = function (t) {
        if (this.h) {
          if (this.m(this.h.k, t))
            return this.o && this.o('hit', n(this.h), this), this.h;
          if (this.h !== this.t)
            for (var i = this.h.n; i; ) {
              if (this.m(i.k, t))
                return this.u(i), this.o && this.o('update', n(i), this), i;
              i = i.n;
            }
        }
      }),
      (e.prototype.g = function (t) {
        for (var i = this.h; i; ) {
          if (this.m(i.k, t)) return i;
          i = i.n;
        }
      }),
      (e.prototype.n = function (t, i) {
        var n = this.h,
          h = this.t,
          e = { k: t, n: n, p: null, v: i };
        return (
          (this.h = e),
          n ? (n.p = e) : (this.t = e),
          ++this.s > this.l && h && this.delete(h),
          e
        );
      }),
      (e.prototype.u = function (t) {
        var i = t.n,
          n = t.p;
        i && (i.p = n),
          n && (n.n = i),
          (this.h.p = t),
          (t.n = this.h),
          (t.p = null),
          (this.h = t),
          t === this.t && (this.t = n);
      }),
      e
    );
  })();
  return function (i, h) {
    void 0 === h && (h = {});
    var o = new e(h),
      s = o.k,
      r = o.o,
      u = function () {
        var h = arguments,
          e = s ? s(h) : h,
          u = o.f(e);
        return (
          u ||
            ((u = o.n(s ? e : t(e), i.apply(this, e))),
            r && r('add', n(u), o),
            o.p &&
              (u.v = u.v.then(
                function (t) {
                  return r && r('resolved', n(u), o), t;
                },
                function (t) {
                  throw (o.delete(u), t);
                },
              ))),
          u.v
        );
      };
    return (u.cache = o), (u.fn = i), (u.isMemoized = !0), (u.options = h), u;
  };
});
