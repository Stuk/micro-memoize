!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self)["micro-memoize"]=t()}(this,(function(){"use strict";function e(e){for(var t=[],n=0,i=e.length;n<i;++n)t[n]=e[n];return t}function t(e,t,n){return typeof t===e?t:n}var n=function(){function n(n){this.entries=[];var r=t("function",n.transformKey);this.isPromise=t("boolean",n.isPromise,!1),this.matchesArg=t("function",n.matchesArg,i),this.matchesKey=t("function",n.matchesKey,this.areKeysEqual),this.maxSize=t("number",n.maxSize,1),this.onChange=t("function",n.onChange),this.shouldClone=!!r||n.matchesKey===this.matchesKey,this.transformKey=this.shouldClone?r?function(t){return r(e(t))}:e:void 0}return n.prototype.add=function(t,n){var i={key:e(t),value:n};return this.onChange&&this.onChange("add",i,this),this.reorder(i,this.entries.length),i},n.prototype.clear=function(){this.entries.length=0},n.prototype.match=function(e){var t=this.entries.length;if(t){var n=this.entries[0];if(this.matchesKey(n.key,e))return this.onChange&&this.onChange("hit",n,this),n;if(1!==t)for(var i=1;i<t;++i)if(n=this.entries[i],this.matchesKey(n.key,e))return this.reorder(n,i),this.onChange&&this.onChange("update",n,this),n}},n.prototype.remove=function(e){var t=this.entries.indexOf(e);-1!==t&&(this.entries.splice(t,1),this.onChange&&this.onChange("remove",e,this))},n.prototype.snapshot=function(){return this.entries.map((function(e){return{key:e.key,value:e.value}}))},n.prototype.areKeysEqual=function(e,t){var n=t.length;if(e.length!==n)return!1;if(1===n)return this.matchesArg(e[0],t[0]);for(var i=0;i<n;++i)if(!this.matchesArg(e[i],t[i]))return!1;return!0},n.prototype.reorder=function(e,t){for(var n=this.entries.length,i=t;i--;)this.entries[i+1]=this.entries[i];this.entries[0]=e,n===this.maxSize&&t===n?this.entries.pop():t>=this.maxSize&&(this.entries.length=this.maxSize)},n}();function i(e,t){return e===t||e!=e&&t!=t}return function(e,t){void 0===t&&(t={});var i=new n(t),r=function(){var t=i.transformKey?i.transformKey(arguments):arguments,n=i.match(t);return n||(n=i.add(t,e.apply(this,t)),i.isPromise&&function(e,t){t.value=t.value.then((function(n){if(e.onChange){var i=e.entries.indexOf(t);0===i?e.onChange("hit",t,e):-1!==i&&e.onChange("update",t,e)}return n}),(function(n){throw e.remove(t),n}))}(i,n)),n.value};return r.cache=i,r.fn=e,r.isMemoized=!0,r}}));
