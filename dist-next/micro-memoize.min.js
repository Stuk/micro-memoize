!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t="undefined"!=typeof globalThis?globalThis:t||self)["micro-memoize"]=n()}(this,(function(){"use strict";var t=function(){function t(t){this.h=null,this.s=0,this.t=null;var e=i("function",t.transformKey);this.a=i("function",t.matchesArg,h),this.l=i("number",t.maxSize,1),this.m=i("function",t.matchesKey,this.e),this.o=i("function",t.onCache),this.p=i("boolean",t.async,!1),this.c=!!e||t.matchesKey===this.m,this.k=this.c?e?function(t){return e(n(t))}:n:void 0}return t.prototype.clear=function(){this.h=this.t=null,this.s=0},t.prototype.delete=function(t){var n=t.n,i=t.p;n?n.p=i:this.t=i,i?i.n=n:this.h=n,--this.s,this.o&&this.o("delete",e(t),this)},t.prototype.get=function(t){var n=this.g(t);return n&&n.v},t.prototype.has=function(t){return!!this.g(t)},t.prototype.set=function(t,n){var i=this.g(t);if(!i){var h=this.n(t,n);return this.o&&this.o("add",e(h),this),h}return i.v=n,i!==this.h&&this.u(i),this.o&&this.o("update",e(i),this),i},t.prototype.snapshot=function(){for(var t=[],n=this.h;null!=n;)t.push(e(n)),n=n.n;return t},t.prototype.e=function(t,n){var i=n.length;if(t.length!==i)return!1;if(1===i)return this.a(t[0],n[0]);for(var e=0;e<i;++e)if(!this.a(t[e],n[e]))return!1;return!0},t.prototype.g=function(t){if(this.h){if(this.m(this.h.k,t))return this.h;if(this.h!==this.t)for(var n=this.h.n;n;){if(this.m(n.k,t))return this.u(n),n;n=n.n}}},t.prototype.n=function(t,n){var i=this;this.p&&(n=n.then((function(t){return i.o&&i.has(s.k)&&i.o("resolved",e(s),i),t}),(function(t){throw i.delete(s),t})));var h=this.h,o=this.t,s={k:t,n:h,p:null,v:n};return this.h=s,h?h.p=s:this.t=s,++this.s>this.l&&o&&this.delete(o),s},t.prototype.u=function(t){var n=t.n,i=t.p;n&&(n.p=i),i&&(i.n=n),this.h.p=t,t.n=this.h,t.p=null,this.h=t,t===this.t&&(this.t=i)},t}();function n(t){for(var n=[],i=0,e=t.length;i<e;++i)n[i]=t[i];return n}function i(t,n,i){return typeof n===t?n:i}function e(t){return{key:t.k,value:t.v}}function h(t,n){return t===n||t!=t&&n!=n}return function i(h,o){if(void 0===o&&(o={}),function(t){return"function"==typeof t&&t.fn}(h))return i(h.fn,Object.assign({},h.options,o));var s=new t(o),r=s.k,u=s.o,f=function(){var t=r?r(arguments):arguments,i=s.h,o=s.g(t);return o?(u&&u(o===i?"hit":"update",e(o),s),o.v):(o=s.n(r?t:n(t),h.apply(this,t)),u&&u("add",e(o),s),o.v)};return f.cache=s,f.fn=h,f.isMemoized=!0,f.options=o,f}}));
